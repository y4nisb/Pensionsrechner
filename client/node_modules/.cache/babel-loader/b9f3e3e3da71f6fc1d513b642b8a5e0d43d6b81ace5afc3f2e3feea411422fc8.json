{"ast":null,"code":"\"use strict\";\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\nconst StorageEvent = require(\"../generated/StorageEvent\");\nconst idlUtils = require(\"../generated/utils\");\nconst {\n  fireAnEvent\n} = require(\"../helpers/events\");\n\n// https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\nclass StorageImpl {\n  constructor(globalObject, args, privateData) {\n    const {\n      associatedWindow,\n      storageArea,\n      url,\n      type,\n      storageQuota\n    } = privateData;\n    this._associatedWindow = associatedWindow;\n    this._items = storageArea;\n    this._url = url;\n    this._type = type;\n    this._quota = storageQuota;\n    this._globalObject = globalObject;\n  }\n  _dispatchStorageEvent(key, oldValue, newValue) {\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin.filter(target => target !== this._associatedWindow).forEach(target => fireAnEvent(\"storage\", target, StorageEvent, {\n      key,\n      oldValue,\n      newValue,\n      url: this._url,\n      storageArea: target[\"_\" + this._type]\n    }));\n  }\n  get length() {\n    return this._items.size;\n  }\n  key(n) {\n    if (n >= this._items.size) {\n      return null;\n    }\n    return [...this._items.keys()][n];\n  }\n  getItem(key) {\n    if (this._items.has(key)) {\n      return this._items.get(key);\n    }\n    return null;\n  }\n  setItem(key, value) {\n    const oldValue = this._items.get(key) || null;\n    if (oldValue === value) {\n      return;\n    }\n\n    // Concatenate all keys and values to measure their length against the quota\n    let itemsTotalLength = key.length + value.length;\n    for (const [curKey, curValue] of this._items) {\n      // If the key already exists, skip it as it will be set to the new value instead\n      if (key !== curKey) {\n        itemsTotalLength += curKey.length + curValue.length;\n      }\n    }\n    if (itemsTotalLength > this._quota) {\n      throw DOMException.create(this._globalObject, [`The ${this._quota}-code unit storage quota has been exceeded.`, \"QuotaExceededError\"]);\n    }\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\n    this._items.set(key, value);\n  }\n  removeItem(key) {\n    if (this._items.has(key)) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\n      this._items.delete(key);\n    }\n  }\n  clear() {\n    if (this._items.size > 0) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\n      this._items.clear();\n    }\n  }\n  get [idlUtils.supportedPropertyNames]() {\n    return this._items.keys();\n  }\n}\nmodule.exports = {\n  implementation: StorageImpl\n};","map":{"version":3,"names":["DOMException","require","StorageEvent","idlUtils","fireAnEvent","StorageImpl","constructor","globalObject","args","privateData","associatedWindow","storageArea","url","type","storageQuota","_associatedWindow","_items","_url","_type","_quota","_globalObject","_dispatchStorageEvent","key","oldValue","newValue","_currentOriginData","windowsInSameOrigin","filter","target","forEach","length","size","n","keys","getItem","has","get","setItem","value","itemsTotalLength","curKey","curValue","create","setTimeout","bind","set","removeItem","delete","clear","supportedPropertyNames","module","exports","implementation"],"sources":["C:/Users/noodp/Documents/GitHub/Pensionsrechner/client/node_modules/jsdom/lib/jsdom/living/webstorage/Storage-impl.js"],"sourcesContent":["\"use strict\";\r\n\r\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\r\nconst StorageEvent = require(\"../generated/StorageEvent\");\r\nconst idlUtils = require(\"../generated/utils\");\r\nconst { fireAnEvent } = require(\"../helpers/events\");\r\n\r\n// https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\r\nclass StorageImpl {\r\n  constructor(globalObject, args, privateData) {\r\n    const { associatedWindow, storageArea, url, type, storageQuota } = privateData;\r\n\r\n    this._associatedWindow = associatedWindow;\r\n    this._items = storageArea;\r\n    this._url = url;\r\n    this._type = type;\r\n    this._quota = storageQuota;\r\n\r\n    this._globalObject = globalObject;\r\n  }\r\n\r\n  _dispatchStorageEvent(key, oldValue, newValue) {\r\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin\r\n      .filter(target => target !== this._associatedWindow)\r\n      .forEach(target => fireAnEvent(\"storage\", target, StorageEvent, {\r\n        key,\r\n        oldValue,\r\n        newValue,\r\n        url: this._url,\r\n        storageArea: target[\"_\" + this._type]\r\n      }));\r\n  }\r\n\r\n  get length() {\r\n    return this._items.size;\r\n  }\r\n\r\n  key(n) {\r\n    if (n >= this._items.size) {\r\n      return null;\r\n    }\r\n    return [...this._items.keys()][n];\r\n  }\r\n\r\n  getItem(key) {\r\n    if (this._items.has(key)) {\r\n      return this._items.get(key);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  setItem(key, value) {\r\n    const oldValue = this._items.get(key) || null;\r\n\r\n    if (oldValue === value) {\r\n      return;\r\n    }\r\n\r\n    // Concatenate all keys and values to measure their length against the quota\r\n    let itemsTotalLength = key.length + value.length;\r\n    for (const [curKey, curValue] of this._items) {\r\n      // If the key already exists, skip it as it will be set to the new value instead\r\n      if (key !== curKey) {\r\n        itemsTotalLength += curKey.length + curValue.length;\r\n      }\r\n    }\r\n    if (itemsTotalLength > this._quota) {\r\n      throw DOMException.create(this._globalObject, [\r\n        `The ${this._quota}-code unit storage quota has been exceeded.`,\r\n        \"QuotaExceededError\"\r\n      ]);\r\n    }\r\n\r\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\r\n\r\n    this._items.set(key, value);\r\n  }\r\n\r\n  removeItem(key) {\r\n    if (this._items.has(key)) {\r\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\r\n\r\n      this._items.delete(key);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    if (this._items.size > 0) {\r\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\r\n\r\n      this._items.clear();\r\n    }\r\n  }\r\n\r\n  get [idlUtils.supportedPropertyNames]() {\r\n    return this._items.keys();\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  implementation: StorageImpl\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}