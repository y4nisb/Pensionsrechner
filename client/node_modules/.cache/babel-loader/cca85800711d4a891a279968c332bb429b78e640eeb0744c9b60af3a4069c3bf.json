{"ast":null,"code":"\"use strict\";\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\nconst NODE_TYPE = require(\"../node-type\");\nconst {\n  nodeLength,\n  nodeRoot\n} = require(\"../helpers/node\");\nconst {\n  domSymbolTree\n} = require(\"../helpers/internal-constants\");\nconst {\n  compareBoundaryPointsPosition\n} = require(\"../range/boundary-point\");\nconst {\n  setBoundaryPointStart,\n  setBoundaryPointEnd\n} = require(\"../range/Range-impl\");\nconst Range = require(\"../generated/Range\");\nconst {\n  implForWrapper\n} = require(\"../generated/utils\");\n\n// https://w3c.github.io/selection-api/#dfn-direction\nconst SELECTION_DIRECTION = {\n  FORWARDS: 1,\n  BACKWARDS: -1,\n  DIRECTIONLESS: 0\n};\n\n// https://w3c.github.io/selection-api/#dom-selection\nclass SelectionImpl {\n  constructor(globalObject) {\n    this._range = null;\n    this._direction = SELECTION_DIRECTION.DIRECTIONLESS;\n    this._globalObject = globalObject;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-anchornode\n  get anchorNode() {\n    const anchor = this._anchor;\n    return anchor ? anchor.node : null;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-anchoroffset\n  get anchorOffset() {\n    const anchor = this._anchor;\n    return anchor ? anchor.offset : 0;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-focusnode\n  get focusNode() {\n    const focus = this._focus;\n    return focus ? focus.node : null;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-focusoffset\n  get focusOffset() {\n    const focus = this._focus;\n    return focus ? focus.offset : 0;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-iscollapsed\n  get isCollapsed() {\n    return this._range === null || this._range.collapsed;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-rangecount\n  get rangeCount() {\n    return this._isEmpty() ? 0 : 1;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-type\n  get type() {\n    if (this._isEmpty()) {\n      return \"None\";\n    } else if (this._range.collapsed) {\n      return \"Caret\";\n    }\n    return \"Range\";\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-getrangeat\n  getRangeAt(index) {\n    if (index !== 0 || this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"Invalid range index.\", \"IndexSizeError\"]);\n    }\n    return this._range;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-addrange\n  addRange(range) {\n    if (range._root === implForWrapper(this._globalObject._document) && this.rangeCount === 0) {\n      this._associateRange(range);\n    }\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-removerange\n  removeRange(range) {\n    if (range !== this._range) {\n      throw DOMException.create(this._globalObject, [\"Invalid range.\", \"NotFoundError\"]);\n    }\n    this._associateRange(null);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-removeallranges\n  removeAllRanges() {\n    this._associateRange(null);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-empty\n  empty() {\n    this.removeAllRanges();\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-collapse\n  collapse(node, offset) {\n    if (node === null) {\n      this.removeAllRanges();\n      return;\n    }\n    if (node.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n      throw DOMException.create(this._globalObject, [\"DocumentType Node can't be used as boundary point.\", \"InvalidNodeTypeError\"]);\n    }\n    if (offset > nodeLength(node)) {\n      throw DOMException.create(this._globalObject, [\"Invalid range index.\", \"IndexSizeError\"]);\n    }\n    if (nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\n      return;\n    }\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset: 0\n      },\n      end: {\n        node,\n        offset: 0\n      }\n    });\n    setBoundaryPointStart(newRange, node, offset);\n    setBoundaryPointEnd(newRange, node, offset);\n    this._associateRange(newRange);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-setposition\n  setPosition(node, offset) {\n    this.collapse(node, offset);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-collapsetostart\n  collapseToStart() {\n    if (this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"There is no selection to collapse.\", \"InvalidStateError\"]);\n    }\n    const {\n      node,\n      offset\n    } = this._range._start;\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset\n      },\n      end: {\n        node,\n        offset\n      }\n    });\n    this._associateRange(newRange);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-collapsetoend\n  collapseToEnd() {\n    if (this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"There is no selection to collapse.\", \"InvalidStateError\"]);\n    }\n    const {\n      node,\n      offset\n    } = this._range._end;\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset\n      },\n      end: {\n        node,\n        offset\n      }\n    });\n    this._associateRange(newRange);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-extend\n  extend(node, offset) {\n    if (nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\n      return;\n    }\n    if (this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"There is no selection to extend.\", \"InvalidStateError\"]);\n    }\n    const {\n      _anchor: oldAnchor\n    } = this;\n    const newFocus = {\n      node,\n      offset\n    };\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset: 0\n      },\n      end: {\n        node,\n        offset: 0\n      }\n    });\n    if (nodeRoot(node) !== this._range._root) {\n      setBoundaryPointStart(newRange, newFocus.node, newFocus.offset);\n      setBoundaryPointEnd(newRange, newFocus.node, newFocus.offset);\n    } else if (compareBoundaryPointsPosition(oldAnchor, newFocus) <= 0) {\n      setBoundaryPointStart(newRange, oldAnchor.node, oldAnchor.offset);\n      setBoundaryPointEnd(newRange, newFocus.node, newFocus.offset);\n    } else {\n      setBoundaryPointStart(newRange, newFocus.node, newFocus.offset);\n      setBoundaryPointEnd(newRange, oldAnchor.node, oldAnchor.offset);\n    }\n    this._associateRange(newRange);\n    this._direction = compareBoundaryPointsPosition(newFocus, oldAnchor) === -1 ? SELECTION_DIRECTION.BACKWARDS : SELECTION_DIRECTION.FORWARDS;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-setbaseandextent\n  setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset) {\n    if (anchorOffset > nodeLength(anchorNode) || focusOffset > nodeLength(focusNode)) {\n      throw DOMException.create(this._globalObject, [\"Invalid anchor or focus offset.\", \"IndexSizeError\"]);\n    }\n    const document = implForWrapper(this._globalObject._document);\n    if (document !== nodeRoot(anchorNode) || document !== nodeRoot(focusNode)) {\n      return;\n    }\n    const anchor = {\n      node: anchorNode,\n      offset: anchorOffset\n    };\n    const focus = {\n      node: focusNode,\n      offset: focusOffset\n    };\n    let newRange;\n    if (compareBoundaryPointsPosition(anchor, focus) === -1) {\n      newRange = Range.createImpl(this._globalObject, [], {\n        start: {\n          node: anchor.node,\n          offset: anchor.offset\n        },\n        end: {\n          node: focus.node,\n          offset: focus.offset\n        }\n      });\n    } else {\n      newRange = Range.createImpl(this._globalObject, [], {\n        start: {\n          node: focus.node,\n          offset: focus.offset\n        },\n        end: {\n          node: anchor.node,\n          offset: anchor.offset\n        }\n      });\n    }\n    this._associateRange(newRange);\n    this._direction = compareBoundaryPointsPosition(focus, anchor) === -1 ? SELECTION_DIRECTION.BACKWARDS : SELECTION_DIRECTION.FORWARDS;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-selectallchildren\n  selectAllChildren(node) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n      throw DOMException.create(this._globalObject, [\"DocumentType Node can't be used as boundary point.\", \"InvalidNodeTypeError\"]);\n    }\n    const document = implForWrapper(this._globalObject._document);\n    if (document !== nodeRoot(node)) {\n      return;\n    }\n    const length = domSymbolTree.childrenCount(node);\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset: 0\n      },\n      end: {\n        node,\n        offset: 0\n      }\n    });\n    setBoundaryPointStart(newRange, node, 0);\n    setBoundaryPointEnd(newRange, node, length);\n    this._associateRange(newRange);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-deletefromdocument\n  deleteFromDocument() {\n    if (!this._isEmpty()) {\n      this._range.deleteContents();\n    }\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-containsnode\n  containsNode(node, allowPartialContainment) {\n    if (this._isEmpty() || nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\n      return false;\n    }\n    const {\n      _start,\n      _end\n    } = this._range;\n    const startIsBeforeNode = compareBoundaryPointsPosition(_start, {\n      node,\n      offset: 0\n    }) === -1;\n    const endIsAfterNode = compareBoundaryPointsPosition(_end, {\n      node,\n      offset: nodeLength(node)\n    }) === 1;\n    return allowPartialContainment ? startIsBeforeNode || endIsAfterNode : startIsBeforeNode && endIsAfterNode;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-stringifier\n  toString() {\n    return this._range ? this._range.toString() : \"\";\n  }\n\n  // https://w3c.github.io/selection-api/#dfn-empty\n  _isEmpty() {\n    return this._range === null;\n  }\n\n  // https://w3c.github.io/selection-api/#dfn-anchor\n  get _anchor() {\n    if (!this._range) {\n      return null;\n    }\n    return this._direction === SELECTION_DIRECTION.FORWARDS ? this._range._start : this._range._end;\n  }\n\n  // https://w3c.github.io/selection-api/#dfn-focus\n  get _focus() {\n    if (!this._range) {\n      return null;\n    }\n    return this._direction === SELECTION_DIRECTION.FORWARDS ? this._range._end : this._range._start;\n  }\n  _associateRange(newRange) {\n    this._range = newRange;\n    this._direction = newRange === null ? SELECTION_DIRECTION.DIRECTIONLESS : SELECTION_DIRECTION.FORWARDS;\n\n    // TODO: Emit \"selectionchange\" event. At this time, there is currently no test in WPT covering this.\n    // https://w3c.github.io/selection-api/#selectionchange-event\n  }\n}\n\nmodule.exports = {\n  implementation: SelectionImpl\n};","map":{"version":3,"names":["DOMException","require","NODE_TYPE","nodeLength","nodeRoot","domSymbolTree","compareBoundaryPointsPosition","setBoundaryPointStart","setBoundaryPointEnd","Range","implForWrapper","SELECTION_DIRECTION","FORWARDS","BACKWARDS","DIRECTIONLESS","SelectionImpl","constructor","globalObject","_range","_direction","_globalObject","anchorNode","anchor","_anchor","node","anchorOffset","offset","focusNode","focus","_focus","focusOffset","isCollapsed","collapsed","rangeCount","_isEmpty","type","getRangeAt","index","create","addRange","range","_root","_document","_associateRange","removeRange","removeAllRanges","empty","collapse","nodeType","DOCUMENT_TYPE_NODE","newRange","createImpl","start","end","setPosition","collapseToStart","_start","collapseToEnd","_end","extend","oldAnchor","newFocus","setBaseAndExtent","document","selectAllChildren","length","childrenCount","deleteFromDocument","deleteContents","containsNode","allowPartialContainment","startIsBeforeNode","endIsAfterNode","toString","module","exports","implementation"],"sources":["C:/Users/noodp/Documents/GitHub/Pensionsrechner/client/node_modules/jsdom/lib/jsdom/living/selection/Selection-impl.js"],"sourcesContent":["\"use strict\";\r\n\r\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\r\n\r\nconst NODE_TYPE = require(\"../node-type\");\r\nconst { nodeLength, nodeRoot } = require(\"../helpers/node\");\r\nconst { domSymbolTree } = require(\"../helpers/internal-constants\");\r\nconst { compareBoundaryPointsPosition } = require(\"../range/boundary-point\");\r\n\r\nconst { setBoundaryPointStart, setBoundaryPointEnd } = require(\"../range/Range-impl\");\r\n\r\nconst Range = require(\"../generated/Range\");\r\nconst { implForWrapper } = require(\"../generated/utils\");\r\n\r\n// https://w3c.github.io/selection-api/#dfn-direction\r\nconst SELECTION_DIRECTION = {\r\n  FORWARDS: 1,\r\n  BACKWARDS: -1,\r\n  DIRECTIONLESS: 0\r\n};\r\n\r\n// https://w3c.github.io/selection-api/#dom-selection\r\nclass SelectionImpl {\r\n  constructor(globalObject) {\r\n    this._range = null;\r\n    this._direction = SELECTION_DIRECTION.DIRECTIONLESS;\r\n\r\n    this._globalObject = globalObject;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-anchornode\r\n  get anchorNode() {\r\n    const anchor = this._anchor;\r\n    return anchor ? anchor.node : null;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-anchoroffset\r\n  get anchorOffset() {\r\n    const anchor = this._anchor;\r\n    return anchor ? anchor.offset : 0;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-focusnode\r\n  get focusNode() {\r\n    const focus = this._focus;\r\n    return focus ? focus.node : null;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-focusoffset\r\n  get focusOffset() {\r\n    const focus = this._focus;\r\n    return focus ? focus.offset : 0;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-iscollapsed\r\n  get isCollapsed() {\r\n    return this._range === null || this._range.collapsed;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-rangecount\r\n  get rangeCount() {\r\n    return this._isEmpty() ? 0 : 1;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-type\r\n  get type() {\r\n    if (this._isEmpty()) {\r\n      return \"None\";\r\n    } else if (this._range.collapsed) {\r\n      return \"Caret\";\r\n    }\r\n\r\n    return \"Range\";\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-getrangeat\r\n  getRangeAt(index) {\r\n    if (index !== 0 || this._isEmpty()) {\r\n      throw DOMException.create(this._globalObject, [\"Invalid range index.\", \"IndexSizeError\"]);\r\n    }\r\n\r\n    return this._range;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-addrange\r\n  addRange(range) {\r\n    if (range._root === implForWrapper(this._globalObject._document) && this.rangeCount === 0) {\r\n      this._associateRange(range);\r\n    }\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-removerange\r\n  removeRange(range) {\r\n    if (range !== this._range) {\r\n      throw DOMException.create(this._globalObject, [\"Invalid range.\", \"NotFoundError\"]);\r\n    }\r\n\r\n    this._associateRange(null);\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-removeallranges\r\n  removeAllRanges() {\r\n    this._associateRange(null);\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-empty\r\n  empty() {\r\n    this.removeAllRanges();\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-collapse\r\n  collapse(node, offset) {\r\n    if (node === null) {\r\n      this.removeAllRanges();\r\n      return;\r\n    }\r\n\r\n    if (node.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\r\n      throw DOMException.create(this._globalObject, [\r\n        \"DocumentType Node can't be used as boundary point.\",\r\n        \"InvalidNodeTypeError\"\r\n      ]);\r\n    }\r\n\r\n    if (offset > nodeLength(node)) {\r\n      throw DOMException.create(this._globalObject, [\"Invalid range index.\", \"IndexSizeError\"]);\r\n    }\r\n\r\n    if (nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\r\n      return;\r\n    }\r\n\r\n    const newRange = Range.createImpl(this._globalObject, [], {\r\n      start: { node, offset: 0 },\r\n      end: { node, offset: 0 }\r\n    });\r\n\r\n    setBoundaryPointStart(newRange, node, offset);\r\n    setBoundaryPointEnd(newRange, node, offset);\r\n\r\n    this._associateRange(newRange);\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-setposition\r\n  setPosition(node, offset) {\r\n    this.collapse(node, offset);\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-collapsetostart\r\n  collapseToStart() {\r\n    if (this._isEmpty()) {\r\n      throw DOMException.create(this._globalObject, [\"There is no selection to collapse.\", \"InvalidStateError\"]);\r\n    }\r\n\r\n    const { node, offset } = this._range._start;\r\n    const newRange = Range.createImpl(this._globalObject, [], {\r\n      start: { node, offset },\r\n      end: { node, offset }\r\n    });\r\n\r\n    this._associateRange(newRange);\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-collapsetoend\r\n  collapseToEnd() {\r\n    if (this._isEmpty()) {\r\n      throw DOMException.create(this._globalObject, [\"There is no selection to collapse.\", \"InvalidStateError\"]);\r\n    }\r\n\r\n    const { node, offset } = this._range._end;\r\n    const newRange = Range.createImpl(this._globalObject, [], {\r\n      start: { node, offset },\r\n      end: { node, offset }\r\n    });\r\n\r\n    this._associateRange(newRange);\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-extend\r\n  extend(node, offset) {\r\n    if (nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\r\n      return;\r\n    }\r\n\r\n    if (this._isEmpty()) {\r\n      throw DOMException.create(this._globalObject, [\"There is no selection to extend.\", \"InvalidStateError\"]);\r\n    }\r\n\r\n    const { _anchor: oldAnchor } = this;\r\n    const newFocus = { node, offset };\r\n\r\n    const newRange = Range.createImpl(this._globalObject, [], {\r\n      start: { node, offset: 0 },\r\n      end: { node, offset: 0 }\r\n    });\r\n\r\n    if (nodeRoot(node) !== this._range._root) {\r\n      setBoundaryPointStart(newRange, newFocus.node, newFocus.offset);\r\n      setBoundaryPointEnd(newRange, newFocus.node, newFocus.offset);\r\n    } else if (compareBoundaryPointsPosition(oldAnchor, newFocus) <= 0) {\r\n      setBoundaryPointStart(newRange, oldAnchor.node, oldAnchor.offset);\r\n      setBoundaryPointEnd(newRange, newFocus.node, newFocus.offset);\r\n    } else {\r\n      setBoundaryPointStart(newRange, newFocus.node, newFocus.offset);\r\n      setBoundaryPointEnd(newRange, oldAnchor.node, oldAnchor.offset);\r\n    }\r\n\r\n    this._associateRange(newRange);\r\n\r\n    this._direction = compareBoundaryPointsPosition(newFocus, oldAnchor) === -1 ?\r\n      SELECTION_DIRECTION.BACKWARDS :\r\n      SELECTION_DIRECTION.FORWARDS;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-setbaseandextent\r\n  setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset) {\r\n    if (anchorOffset > nodeLength(anchorNode) || focusOffset > nodeLength(focusNode)) {\r\n      throw DOMException.create(this._globalObject, [\"Invalid anchor or focus offset.\", \"IndexSizeError\"]);\r\n    }\r\n\r\n    const document = implForWrapper(this._globalObject._document);\r\n    if (document !== nodeRoot(anchorNode) || document !== nodeRoot(focusNode)) {\r\n      return;\r\n    }\r\n\r\n    const anchor = { node: anchorNode, offset: anchorOffset };\r\n    const focus = { node: focusNode, offset: focusOffset };\r\n\r\n    let newRange;\r\n    if (compareBoundaryPointsPosition(anchor, focus) === -1) {\r\n      newRange = Range.createImpl(this._globalObject, [], {\r\n        start: { node: anchor.node, offset: anchor.offset },\r\n        end: { node: focus.node, offset: focus.offset }\r\n      });\r\n    } else {\r\n      newRange = Range.createImpl(this._globalObject, [], {\r\n        start: { node: focus.node, offset: focus.offset },\r\n        end: { node: anchor.node, offset: anchor.offset }\r\n      });\r\n    }\r\n\r\n    this._associateRange(newRange);\r\n\r\n    this._direction = compareBoundaryPointsPosition(focus, anchor) === -1 ?\r\n      SELECTION_DIRECTION.BACKWARDS :\r\n      SELECTION_DIRECTION.FORWARDS;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-selectallchildren\r\n  selectAllChildren(node) {\r\n    if (node.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\r\n      throw DOMException.create(this._globalObject, [\r\n        \"DocumentType Node can't be used as boundary point.\",\r\n        \"InvalidNodeTypeError\"\r\n      ]);\r\n    }\r\n\r\n    const document = implForWrapper(this._globalObject._document);\r\n    if (document !== nodeRoot(node)) {\r\n      return;\r\n    }\r\n\r\n    const length = domSymbolTree.childrenCount(node);\r\n\r\n    const newRange = Range.createImpl(this._globalObject, [], {\r\n      start: { node, offset: 0 },\r\n      end: { node, offset: 0 }\r\n    });\r\n\r\n    setBoundaryPointStart(newRange, node, 0);\r\n    setBoundaryPointEnd(newRange, node, length);\r\n\r\n    this._associateRange(newRange);\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-deletefromdocument\r\n  deleteFromDocument() {\r\n    if (!this._isEmpty()) {\r\n      this._range.deleteContents();\r\n    }\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-containsnode\r\n  containsNode(node, allowPartialContainment) {\r\n    if (this._isEmpty() || nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\r\n      return false;\r\n    }\r\n\r\n    const { _start, _end } = this._range;\r\n\r\n    const startIsBeforeNode = compareBoundaryPointsPosition(_start, { node, offset: 0 }) === -1;\r\n    const endIsAfterNode = compareBoundaryPointsPosition(_end, { node, offset: nodeLength(node) }) === 1;\r\n\r\n    return allowPartialContainment ?\r\n      startIsBeforeNode || endIsAfterNode :\r\n      startIsBeforeNode && endIsAfterNode;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dom-selection-stringifier\r\n  toString() {\r\n    return this._range ? this._range.toString() : \"\";\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dfn-empty\r\n  _isEmpty() {\r\n    return this._range === null;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dfn-anchor\r\n  get _anchor() {\r\n    if (!this._range) {\r\n      return null;\r\n    }\r\n\r\n    return this._direction === SELECTION_DIRECTION.FORWARDS ?\r\n      this._range._start :\r\n      this._range._end;\r\n  }\r\n\r\n  // https://w3c.github.io/selection-api/#dfn-focus\r\n  get _focus() {\r\n    if (!this._range) {\r\n      return null;\r\n    }\r\n\r\n    return this._direction === SELECTION_DIRECTION.FORWARDS ?\r\n      this._range._end :\r\n      this._range._start;\r\n  }\r\n\r\n  _associateRange(newRange) {\r\n    this._range = newRange;\r\n    this._direction = newRange === null ? SELECTION_DIRECTION.DIRECTIONLESS : SELECTION_DIRECTION.FORWARDS;\r\n\r\n    // TODO: Emit \"selectionchange\" event. At this time, there is currently no test in WPT covering this.\r\n    // https://w3c.github.io/selection-api/#selectionchange-event\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  implementation: SelectionImpl\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}